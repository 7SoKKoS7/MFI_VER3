# Методика MasterForex-V - Краткое описание

## Основные принципы

### 1. Мультитаймфреймовый анализ
- **M5, M15, H1** - основные таймфреймы для анализа
- **H4, D1** - дополнительные для контекста
- Строгая иерархия: старшие ТФ задают направление, младшие - точки входа

### 2. Система MF-pivot
- **PivotHigh/PivotLow** - подтвержденные уровни поддержки/сопротивления
- Расчет через ZigZag с адаптивным порогом
- Подтверждение только на закрытых барах
- Кеширование для стабильности

### 3. Определение тренда
- **Up**: Close[1] > PivotLow + tolerance
- **Down**: Close[1] < PivotHigh - tolerance  
- **Flat**: между уровнями или ближе tolerance
- Tolerance = max(2*_Point, K*ATR(TF))

### 4. Система силы тренда
- **3/3** - очень сильный (все ТФ совпадают)
- **2/3** - сильный (основные ТФ совпадают)
- **1/3** - слабый (частичное совпадение)

## Типы сигналов

### Сильные сигналы (желтые стрелки)
- Все 3 ТФ совпадают (H1, M15, M5)
- Сила тренда = 3/3
- Объем подтвержден (2/3 ТФ)
- Валидная торговая сессия

### Обычные сигналы (зеленые/красные стрелки)
- Все 3 ТФ совпадают
- Сила тренда = 1-2/3
- Объем подтвержден
- Валидная торговая сессия

### Ранние сигналы (голубые стрелки)
- Частичное совпадение ТФ
- Слабая сила тренда
- Объем подтвержден
- Валидная торговая сессия

## Фильтры качества

### 1. Объемный фильтр
- Анализ объема на M5, M15, H1
- Требование: минимум 2/3 ТФ подтверждают
- Используются завершенные бары

### 2. Сессионный фильтр
- Лондон: 8-16 GMT
- Нью-Йорк: 13-21 GMT  
- Токио: 0-8 GMT
- Автокоррекция DST

### 3. Фильтр схватки (Clinch)
- Зона между PivotHigh_H1 и PivotLow_H1
- Частые перебросы цены
- Сжатый диапазон движения
- Понижение класса сигналов

### 4. Фильтр фазы рынка
- Детекция Flat/Trend по M15
- Во флете сигналы понижаются до Early
- Основан на соотношении качелей

### 5. Фильтр импульса/отката
- Анализ структуры A-B-C на M15
- Оценка здоровья импульса
- Контроль глубины отката

## Система выходов

### Режимы выхода
- **H1** (по умолчанию): по pivot H1
- **EntryTF**: по pivot ТФ входа
- **Nearest**: ближайший pivot с фильтром ATR
- **SoftHard**: два уровня выхода

### Сигналы выхода
- **Жесткий выход**: пересечение противоположного pivot
- **Ранний выход**: по ближайшему pivot
- **Разворот**: изменение направления тренда

## Консенсус-система

### Три голоса
1. **MF-ядро**: основная логика индикатора
2. **EMA**: направление EMA50/200 на M15
3. **RSI**: состояние RSI(14) на M15

### Режимы работы
- **PanelOnly**: только отображение
- **GateStrong**: без 2/3 Strong → Normal
- **GateStrongNormal**: без 2/3 понижение класса
- **BlockAll**: без 2/3 блокировка входов

## Технические особенности

### No Repaint политика
- Все решения на закрытых барах
- Использование Close[1] вместо Close[0]
- Подтверждение только после закрытия бара

### Кеширование
- Глобальные переменные терминала
- Кеш пивотов между переключениями ТФ
- Быстрый старт с кешированными значениями

### Производительность
- Оптимизированные расчеты ZigZag
- Мемоизация результатов
- Троттлинг обновлений

## Валидация и тестирование

### Исторические данные
- CSV файлы в data/EURUSD/
- Оффлайн-валидация стратегий
- Бэктестинг различных настроек

### Критерии качества
- Стабильность сигналов
- Отсутствие перерисовки
- Соответствие методике MF-V
- Производительность в реальном времени
